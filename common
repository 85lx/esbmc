include $(ESBMCDIR)/config.inc
include $(ESBMCDIR)/local.inc

OBJS1 = $(SRCS:.c=.o)
OBJS+= $(OBJS1:.cpp=.o)

# list of includes, potentially modified by includer
INCLUDES+= -I$(ESBMCDIR) -I$(ESBMCDIR)/util

CFLAGS+= $(GCCFLAGS) $(INCLUDES)
CXXFLAGS+= $(GCCFLAGS) $(INCLUDES)

.SUFFIXES:	.C .d .cpp

.C.o:
	$(CXX) -c $(CXXFLAGS) -o $@ $<

.cpp.o:
	$(CXX) -c $(CXXFLAGS) -o $@ $<

.c.o:
	$(CC) -c $(CFLAGS) -o $@ $<

#
# include a dependency file if one exists
#

# ifeq (.depend,$(wildcard .depend))
# include .depend
# endif

D_FILES1 = $(SRC:.c=.d)
D_FILES = $(D_FILES1:.cpp=.d)

-include $(D_FILES)

# A generic target; potentially overwritten by the includer

all: $(MAINOBJ)

$(MAINOBJ): $(OBJS)
	$(LD) $(LDFLAGS) -r -o $@ $^

#clean defined by includer

ifdef DIRS
depend:
	for dir in $(DIRS); do \
		$(MAKE) -C $$dir depend; \
	done
else
depend: $(SRCS)
	$(CXX) $(INCLUDES) -MM $(SRCS) > .deps
endif

.PHONY: clean depend
